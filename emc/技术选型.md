###### 硬件和操作系统层面优化：

- cpu 可用内存大小 网络带宽 磁盘读写速度。应用文件句炳数 操作系统的网络配置

###### 架构设计层面优化：

##### 读写分离（主写从读）

##### 读写分离（主写从读）

#### 背景

- 读多写少，可以容忍不一致

#### 目的

- 提升读并发

#### 主从同步失败

- 强制读主 从库只有备份作用，没有分担读压力作用
- 主从同步复制，写操作性能降低
- GTID
- 去掉读写分离，改用缓存。缓存出现读写不一致现象

#### 优劣

- 主从主要是拓展性不强，一旦并发量大了，容易把mysql连接数打满
- 两千内并发。

##### 分库分表

- 一台物理机器部署一个库，连接分散到不同库，根据不同账号进不同库，分库分表。多个物理机，并发切库
- 不同机房通过cdn解决cc攻击。服务器配置：32核32g72线程

##### mongodb

#### 不支持事务，不太适合放订单，金额。

##### 分布式事务

- mq削峰填谷或者db。
- es物理库的订单查询。一两亿一两秒。
- mysql定时任务定时汇总到报表。
- 玩家盈亏：五百万，七秒。
- kafka把消息发到大数据。
- 冷热备份，产品限制查两个月，分区表，一天一千万。

# 怎么保证事务，怎么聚合怎么查。

# 金额 账变 注单 避免分布式事务

# 分多个库，然后

# 机房配置

# 数据库io瓶颈提升

# 缓存不一致

- 涉及金额，订单不存缓存。redis发布订阅通知游戏更新，通知不成功，定时任务。
- 很容易出现，redis缓存不一致。玩家登陆，把库更新，redis没更新成功，机房，内网一般稳定。
- cocos图片加密，混淆一下。

# 下注 充值 哈希 会员 代理  日志 事务 日志耗时

###### mysq配置层面优化：

- binlog
- bufferpool大小配置

###### 运维架构容灾

- 两地三中心

